<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
		<style>
        
            /* Note: css styles will be overwritten by D3 attributes  */
            
            body { /* HTML element selector */
                background-color: #FBF2EF;
            }

			p {
                font-size: 12px;
                background-color: white;
                color: black;
            }
            
            pink {
                font-size: 14px;
                color: pink;
                font-style: oblique;
            }
            #rect-demo { /* id selector,  used to specify a style for a single, unique element */
                fill: red;
                stroke: black;
            }
            
            .barplot { /* class selector, used to specify a style for a group of elements */
                background-color: #e5eecc;
                fill: #8ac007;
            }
            
            #maps { /* id selector,  used to specify a style for a single, unique element */               
                background-color: #364765;
            }
            
            /*svg {
                shape-rendering: crispEdges;
            }*/
		</style>
		
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
		
        <div id = "rect-demo"></div>
        
        <div id = "bar-demo"> </div>
        
        <div id = "group-demo"> </div>
        
        <div id = maps>
            <div id = "map-demo">            
            </div>
            <pink>Click to zoom, when zoomed: click in middle to zoom out, other areas to pan (slide) </pink>
            
            <br>
            
            <div id="map-world">
            <pink> A world map </pink>
            
         </div>
        
         <p id="debug">
            <b>Debug info</b>
            <br>
         </p>
        
        </div>
    </head>
    <body>	
		
		
		
        <script>
        
        
            // d3 code
            
            // d3.select() can take any CSS selector as an argument
            // d3.append() is used to add a new element as a child of the selected element
            
            //////////
            // black rectangle
            //////////
			var rectDemo = d3.select("#rect-demo").
                append("svg"). // inserts <svg .. > tag in div 
                attr("width", 400).
                attr("height", 300);
            
            var rect = rectDemo.append("rect").// inserts <rect .. > tag in <svg .. > tag
                    attr("x",100).
                    attr("y", 100).
                    attr("height", 100).
                    attr("width", 200);            
            
            rectDemo.selectAll("text").
                data([{author: "Malevitsj"}]).
                enter().
                append("text").
                attr("x", d3.select("rect").attr("x")).
                attr("y", d3.select("rect").attr("y") ).
                text( function(datum) { return datum.author; } );
                
            /////////////////
            // bar plot
            /////////////////
            
            // If the data is a simple array of numbers, the scale itself can be passed to 
            // the attr method: attr("x", xScale)            
            var xScale = d3.scale.linear().
                domain([0,200]). // data min and max
                range([0,100]); // width of the diagram

            var booksData = [   {year:2006, books: 54},
                                {year:2007, books:43},
                                {year:2008, books:41},
                                {year: 2009, books: 44},
                                {year: 2010, books: 35},
                                {year: 2011, books:41}
                            ];
            var barWidth = 40;
            var diagramWidth = (barWidth + 10) * booksData.length;
            var diagramHeight = 200;
            var xAxisHeight = 20;
            // d3.scale.linear() returns a function
            // xFun: array index --> x coordinate
            var xFun = d3.scale.linear().
                        domain([0, booksData.length]).
                        range([222, diagramWidth+222]);
            // yFun: books --> height
            var yFun = d3.scale.linear().       // maximum of books for all entries in booksData
                        domain([0, d3.max(  booksData, // d3.max() takes an optional accessor as its second argument
                                            function(datum) { 
                                                return datum.books;
                                            })]).
                        rangeRound([0, diagramHeight]);
            
            var barDemo = d3.select("#bar-demo").
                append("svg").
                attr("width", diagramWidth+222).
                attr("height", diagramHeight+xAxisHeight).
                attr("class", "barplot"); // allowing stylesheets to be applied to the element 
            
            //document.getElementById("debug").innerHTML += "selected #bar-demo <br>"; 

            // put in the bars (rects)
            barDemo.selectAll("rect").
                data(booksData).
                enter().
                append("rect").
                attr("x", function(datum, index) { return xFun(index); }).
                attr("y", function(datum) { return diagramHeight - yFun(datum.books); }).
                attr("height", function(datum) { return yFun(datum.books); } ).
                attr("width", barWidth).
                attr("fill", "#3284c4");
            
            
            //debug
            document.getElementById("debug").innerHTML += "barDemo var created <br>";             
            document.getElementById("debug").innerHTML += "\nHoeveelheid books: " + booksData.length;
            
            // put in the numbers (text) 
            barDemo.selectAll("text").
                data(booksData).
                enter().
                append("text").
                attr("x", function(datum, index) { return xFun(index) ; } ).
                attr("y", function(datum) { return diagramHeight - yFun(datum.books); } ).
                attr("dx", barWidth/2).
                attr("dy", "1.2em").
                attr("text-achor","middle"). //  characters  aligned such that the middle of the text string is at the current text position.
                text( function(datum) { return datum.books; } ).
                attr("fill", "white");
            
            // put in x axis (text)           
            barDemo.selectAll("text.yAxis").
              data(booksData).
              enter().append("text").
              attr("x", function(datum, index) { return xFun(index) + barWidth; }).
              attr("y", diagramHeight+xAxisHeight).
              attr("dx", -barWidth/2).
              attr("text-anchor", "middle").
              attr("style", "font-size: 12; font-family: Helvetica, sans-serif").
              text(function(datum) { return datum.year;}).
              attr("fill","black");              
                
            
            /////////////////
            // circles & rects group example
            /////////////////
            
            var circleData = [  { "cx": 20, "cy": 20, "radius": 20, "color": "green"},
                                { "cx": 70, "cy": 70, "radius": 20, "color": "purple"}];
            var rectangleData = [   {"rx": 110, "ry": 110, "height": 30, "width":30, "color":"blue"},
                                    {"rx": 160, "ry": 160, "height": 30, "width":30, "color":"red"}];
            
            // create general container in "group-demo" div tag  + groups
            var svgContainer = d3.select("#group-demo").
                                append("svg").
                                attr("width",250).
                                attr("height",200);
                                
            var circleGroup = svgContainer.append("g");
            var rectangleGroup = svgContainer.append("g").
                                    attr("transform", "skewX(10)");
            
            var circles = circleGroup.selectAll("circle").
                                data(circleData).
                                enter().
                                append("circle");
                                
            var circleAttributes = circles.
                                    attr("cx", function(datum) {return datum.cx; }).
                                    attr("cy", function(datum) { return datum.cy;}).
                                    attr("r", function(datum) { return datum.radius;}).
                                    style("fill", function(datum) { return datum.color; });
            
            var rectangles = rectangleGroup.selectAll("rect").
                                data(rectangleData).
                                enter().
                                append("rect").
                                attr("x", function(datum) {return datum.rx; }).
                                attr("y", function(datum) { return datum.ry;}).
                                attr("height", function(datum) { return datum.height;}).
                                attr("width", function(datum) { return datum.width;}).
                                style("fill", function(datum) { return datum.color; });
                                
             document.getElementById("debug").innerHTML += "<br> circles/rectangles done<br>";    
             
            /////////////////
            // a geo based map
            /////////////////
            /*  The path element represents the outline of a shape which can be filled, 
                stroked, used as a clipping path, or any combination of the three. 
                ---> The d attribute defines the path data, which is a mini-language of path commands, <--- 
                such as moveto (M), lineto (L) and closepath (Z). 
                The path element is a generalization of all other shapes in SVG, 
                and can be used to draw nearly anything!
            */
            var mapHeight = 300;
            var mapWidth = 450;
            
           
          
            var svgMap = d3.select("#map-demo").
                            append("svg").
                            attr("x", 0).
                            attr("y", 0).
                            attr("width", mapWidth).
                            attr("height",mapHeight);
            
            // draw a rect in the svg so that the map has a background/border
            var rectMap = svgMap.append("rect").
                            attr("x", 0).
                            attr("y", 0).
                            attr("width", mapWidth+2).
                            attr("height",mapHeight+2).
                            attr("fill", "pink");
            
                           
            var groupMap = svgMap.append("g").
                attr("id", "group-map").
                attr("x", 2).
                attr("y", 2).
                attr("transform", "scale(.5, .5)");
            
            document.getElementById("debug").innerHTML += "Made groupMap <br>";    
            
            var projection = d3.geo.albersUsa();
            document.getElementById("debug").innerHTML += "Made projection var <br>";    
           
            //var path = d3.geo.path(); // this is a function that takes geojson data and transforms it to svg
            var path = d3.geo.path().projection(projection);
            
            var mapColors = d3.scale.linear().domain([1,12]).range(['pink', '#304057']);
            var centered;
            
            document.getElementById("debug").innerHTML += "Path: " + path + " <br>";  
            
            // "https://gist.github.com/mshafrir/2646763/raw/f2a89b57193e71010386a73976df92d32221d7ba/states_hash.json"            
            d3.json("us-states.json", function(error, json) {
                if (error) {  
                    document.getElementById("debug").innerHTML += "Error loading map file <br>"; 
                    return console.warn(error); 
                }
                console.log(json);
                
                groupMap.selectAll("path").   
                    data(json.features).
                    enter().
                    append("path").
                    attr("id", function(data) { return data.properties.name; }). // name of states
                    attr("d", path). // svg path                   
                    //style("fill", "#304057").
                    style("fill", function(data) { // fill based on state name length
                                    return mapColors(data.properties.name.length);
                                    }).                        
                    attr("stroke", "black").
                    attr("stroke-width", 2).
                    on("click", clickFun); // click is a function
                    
                document.getElementById("debug").innerHTML += "Put data in groupMap var  <br>";        
            });
            
        // the zoom function, not 100% sure how this works
        function clickFun(d) {
            var x = 0, y = 0, k = 0.3;
            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = -centroid[0] + mapWidth/4;
                y = -centroid[1] + mapHeight / 4;
                k = 2;
                centered = d;
            }
            else {
                centered = null;
            }
            groupMap.selectAll("path").
                classed("active", centered && function(d) { return d === centered; });
            groupMap.transition().
                duration(1000).
                attr("transform", "scale("+ k + ") translate (" + x + mapWidth/2 + "," + y + ")").
                attr("stroke-width", 1.5/k);
            
        }
        
        /////////////
        // world map
        /////////////
        
        var svgMapWorld = d3.select("#map-world").
                            append("svg").
                            attr("x", 0).
                            attr("y", 0).
                            attr("width", 1000).
                            attr("height",1000);
         
        var groupMapWorld = svgMapWorld.append("g").
                attr("id", "group-map-world").
                attr("x", 2).
                attr("y", 2).
                attr("transform", "scale(.5, .5)");
                
        d3.json("all-countries.json", function(error, collection) {
        
            if (error) {  
                document.getElementById("debug").innerHTML += "Error loading world map file <br>"; 
                return console.warn(error); 
            }
            console.log(collection);
        
            groupMapWorld.selectAll("path").
                data(collection.features).
                enter().
                append("path").
                    attr("stroke", "black").
                    attr("id", function(data) { return data.properties.name; }). 
                    attr("d", d3.geo.path().projection(
                        d3.geo.albers().
                            parallels([10, 10]).
                            translate([500,800]).
                            scale(200)
                        )
                    );
            }
        );
                    
        </script>
        
        
    </body>
</html>     